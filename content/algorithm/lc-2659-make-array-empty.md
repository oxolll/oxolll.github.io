---
title: "LeetCode 2659. Make Array Empty"
date: 2026-02-21T23:55:00+08:00
lastmod: 2026-02-21T23:55:00+08:00
difficulty: 2281
draft: false
hidden: false
# --- ç›®éŒ„è¨­å®š ---
ShowToc: true
TocOpen: false
# --- æ•¸å­¸å…¬å¼è¨­å®š ---
math: true
categories: ["Algorithm"]
tags: ["LeetCode", "Binary Indexed Tree (Fenwick Tree)", "Array", "Sorting"]
keywords: ["LC2659", "2281", "Hard", "BIT", "Fenwick Tree", "Circular Array"]
description: "LeetCode ç¬¬ 2659 é¡Œï¼šMake Array Emptyã€‚é›£åº¦è©•åˆ†ï¼š2281ã€‚æ¢è¨å¦‚ä½•åˆ©ç”¨ Binary Indexed ÃŸÃŸTree (BIT) ç¶­è­·å­˜æ´»å…ƒç´ ï¼Œä¸¦è™•ç†ç’°ç‹€é™£åˆ—ä¸Šçš„è·é›¢è¨ˆç®—å•é¡Œã€‚"
---

## ğŸ“Š é¡Œç›®è³‡è¨Š
> **é¡Œç›®é€£çµ**ï¼š[LeetCode 2659](https://leetcode.com/problems/make-array-empty/)  
> **é›£åº¦è©•åˆ†**ï¼š<span style="color: #ff375f; font-weight: bold;">Hard(2281)</span>   
> **æ ¸å¿ƒä¸»é¡Œ**ï¼š`Binary Indexed Tree` $\cdot$ `Array` $\cdot$ `Sorting`

---

## ğŸ“– é¡Œç›®æè¿°
<details>
<summary>ğŸ” <b>é»æ“Šå±•é–‹é¡Œç›®è©³æƒ…èˆ‡é™åˆ¶</b></summary>

### èªªæ˜
çµ¦å®šä¸€å€‹åŒ…å«ç›¸ç•°æ•´æ•¸çš„é™£åˆ— `nums`ã€‚ä½ å¯ä»¥åŸ·è¡Œä»¥ä¸‹æ“ä½œç›´åˆ°é™£åˆ—ç‚ºç©ºï¼š
- å¦‚æœé™£åˆ—çš„ç¬¬ä¸€å€‹å…ƒç´ æ˜¯ç›®å‰é™£åˆ—ä¸­çš„**æœ€å°å€¼**ï¼Œå‰‡å°‡å…¶åˆªé™¤ã€‚
- å¦å‰‡ï¼Œå°‡ç¬¬ä¸€å€‹å…ƒç´ ç§»åˆ°é™£åˆ—çš„**æœ€å°¾ç«¯**ã€‚

è«‹å›å‚³å°‡ `nums` æ¸…ç©ºæ‰€éœ€çš„ç¸½æ“ä½œæ¬¡æ•¸ã€‚

### ç¯„ä¾‹
- **Input**: `nums = [3,4,-1]` â†’ **Output**: `5`
- **Explanation**: 
  1. `[4, -1, 3]` (3 ä¸æ˜¯æœ€å°ï¼Œç§»åˆ°å°¾ç«¯)
  2. `[-1, 3, 4]` (4 ä¸æ˜¯æœ€å°ï¼Œç§»åˆ°å°¾ç«¯)
  3. `[3, 4]` (-1 æ˜¯æœ€å°ï¼Œåˆªé™¤å®ƒ)
  4. `[4]` (3 æ˜¯æœ€å°ï¼Œåˆªé™¤å®ƒ)
  5. `[]` (4 æ˜¯æœ€å°ï¼Œåˆªé™¤å®ƒ)
  ç¸½å…± 5 æ¬¡æ“ä½œã€‚

### é™åˆ¶æ¢ä»¶
- $1 \le nums.length \le 10^5$
- $-10^9 \le nums[i] \le 10^9$
- æ‰€æœ‰çš„ `nums[i]` çš†ä¸ç›¸åŒã€‚
</details>

---

## ğŸ“ æ­·æ¬¡æ‰“å¡èˆ‡æ›´æ–°
- [2026-02-21ï¼šåˆæ¬¡æäº¤ (BIT ç¶­è­·å­˜æ´»å…ƒç´ èˆ‡ç’°ç‹€å€é–“æ±‚å’Œ)](#2026-02-21-åˆæ¬¡æäº¤)

---

## ğŸ’¡ 2026-02-21 åˆæ¬¡æäº¤

### ğŸ¯ ç›´è¦º (Intuition)
å‰›é–‹å§‹åšé€™é¡Œæ™‚ï¼ŒçŸ¥é“è¦ç”¨ BIT ç¶­è­·å…ƒç´ çš„å­˜æ´»ç‹€æ…‹ï¼ˆå› ç‚ºæœƒä¸€ç›´åˆªé™¤ï¼‰ï¼Œä½†å¡åœ¨ä¸çŸ¥é“æ€éº¼ç´¯åŠ æ“ä½œæ¬¡æ•¸ `rt`ã€‚ä»”ç´°æ€è€ƒã€Œç§»åˆ°å°¾ç«¯ã€é€™å€‹å‹•ä½œï¼Œå…¶å¯¦ç­‰åƒ¹æ–¼**æŠŠé™£åˆ—é ­å°¾ç›¸æ¥è®Šæˆä¸€å€‹ç’° (Circular Array)**ï¼Œç„¶å¾Œæˆ‘å€‘å§‹çµ‚æœè‘—åŒä¸€å€‹æ–¹å‘ï¼ˆå‘å³ï¼‰èµ°ã€‚
æ¯æ¬¡èµ°åˆ°ç•¶å‰çš„æœ€å°å€¼ä¸¦åˆªé™¤å®ƒæ™‚ï¼Œæˆ‘å€‘æ‰€èŠ±è²»çš„æ“ä½œæ¬¡æ•¸ï¼Œå…¶å¯¦å°±æ˜¯**ã€Œå¾ä¸Šä¸€æ¬¡åˆªé™¤çš„ä½ç½®ï¼Œèµ°åˆ°é€™æ¬¡è¦åˆªé™¤çš„ä½ç½®ï¼Œè·¯å¾‘ä¸Šã€é‚„æ´»è‘—ã€çš„å…ƒç´ æ•¸é‡ã€**ã€‚æƒ³é€šé€™ä¸€é»å¾Œï¼Œå•é¡Œå°±åŒ–ç°¡ç‚ºå…©ç¨®æƒ…æ³çš„å€é–“æ±‚å’Œäº†ã€‚

### ğŸ› ï¸ è§£é¡Œæ€è·¯ (Approach)
1. **ç¢ºå®šåˆªé™¤é †åº**ï¼š
   é™£åˆ—åªèƒ½å¾å°åˆ°å¤§åˆªé™¤ã€‚æ‰€ä»¥å…ˆè¤‡è£½ä¸€ä»½ `nums` ä¸¦æ’åºï¼Œå†é€é Hash Map è¨˜éŒ„æ¯å€‹å€¼åŸæœ¬å°æ‡‰çš„ 0-indexed ç´¢å¼•ï¼Œç”¢ç”Ÿä¸€å€‹ä¾åºè¦åˆªé™¤çš„ç›®æ¨™ç´¢å¼•é™£åˆ— `arr`ã€‚
2. **å»ºæ§‹ BIT**ï¼š
   åˆå§‹åŒ–ä¸€å€‹å¤§å°ç‚º $N+1$ çš„ BITï¼Œä¸€é–‹å§‹æ¯å€‹ä½ç½®çš„å€¼éƒ½æ˜¯ `1`ï¼Œä»£è¡¨å…ƒç´ çš†å­˜æ´»ï¼ˆä½¿ç”¨ $\mathcal{O}(N)$ ç·šæ€§å»ºæ¨¹å„ªåŒ–ï¼‰ã€‚
3. **åˆ†æƒ…æ³è¨ˆç®—ç’°ç‹€è·é›¢ (æ ¸å¿ƒç—›é»)**ï¼š
   è¨­ä¸Šä¸€æ¬¡åˆªé™¤çš„ç´¢å¼•ç‚º `pre`ï¼ˆåˆå§‹ç‚º `-1` ä»£è¡¨èµ·é»ï¼‰ï¼Œé€™æ¬¡è¦åˆªé™¤çš„ç´¢å¼•ç‚º `cur`ã€‚
   - **æƒ…æ³ä¸€ (`cur >= pre`)**ï¼šç›®æ¨™åœ¨å³é‚Šï¼Œæˆ‘å€‘å¯ä»¥ç›´æ¥ç›´ç›´èµ°éå»ã€‚
     èŠ±è²»æ¬¡æ•¸ = å€é–“ `(pre, cur]` å…§å­˜æ´»çš„å…ƒç´ æ•¸é‡ = `getSum(cur) - getSum(pre)`ã€‚
   - **æƒ…æ³äºŒ (`cur < pre`)**ï¼šç›®æ¨™åœ¨å·¦é‚Šï¼Œä»£è¡¨æˆ‘å€‘å¿…é ˆèµ°åˆ°é™£åˆ—åº•ç«¯ï¼Œç„¶å¾Œå¾é ­ç¹å›ä¾†ã€‚
     èŠ±è²»æ¬¡æ•¸ = èµ°åˆ°é™£åˆ—åº•ç«¯çš„å­˜æ´»æ•¸é‡ + ç¹å›é ­èµ°åˆ° `cur` çš„å­˜æ´»æ•¸é‡
     = `(getSum(n-1) - getSum(pre)) + (getSum(cur) - getSum(-1))`ã€‚
4. **åˆªé™¤èˆ‡æ›´æ–°**ï¼š
   ç®—å®Œè·é›¢å¾Œï¼ŒæŠŠè©²å…ƒç´ æ¨™è¨˜ç‚ºå·²åˆªé™¤ `update(cur, -1)`ï¼Œä¸¦æ›´æ–° `pre = cur`ï¼Œç›´åˆ°åˆªé™¤æ‰€æœ‰å…ƒç´ ã€‚

### ğŸ“Š è¤‡é›œåº¦åˆ†æ
- **æ™‚é–“è¤‡é›œåº¦**: $\mathcal{O}(N \log N)$ã€‚æ’åºéœ€è¦ $\mathcal{O}(N \log N)$ï¼Œéæ­·åˆªé™¤éç¨‹å…±æŸ¥è©¢/æ›´æ–° $N$ æ¬¡ BITï¼Œæ¯æ¬¡è€—æ™‚ $\mathcal{O}(\log N)$ã€‚
- **ç©ºé–“è¤‡é›œåº¦**: $\mathcal{O}(N)$ã€‚éœ€è¦é¡å¤–ç©ºé–“å„²å­˜ `BIT`ã€`sorted` é™£åˆ—ã€æ˜ å°„ç”¨çš„ Map ä»¥åŠåˆªé™¤é †åº `arr`ã€‚

### ğŸ’» ç¨‹å¼ç¢¼å¯¦ä½œ (C++)
```cpp
class Solution {
public:
    int n;
    vector<int> BIT;
    
    long long countOperationsToEmptyArray(vector<int>& nums) {
        n = nums.size();
        
        // 1. å–å¾—æ’åºå¾Œçš„çµæœ
        vector<int> sorted(nums.begin(), nums.end());
        sort(sorted.begin(), sorted.end());

        // 2. è¨˜éŒ„åŸå§‹å€¼åˆ°åŸå§‹ç´¢å¼•çš„æ˜ å°„ (0-indexed)
        unordered_map<int, int> mp;
        for(int i = 0; i < n; ++i)
            mp[nums[i]] = i;
        
        // 3. æŒ‰ç…§ç”±å°åˆ°å¤§çš„é †åºï¼Œå»ºç«‹ç›®æ¨™ç´¢å¼•é™£åˆ— arr
        vector<int> arr; 
        arr.reserve(n);
        for(auto val : sorted)
            arr.push_back(mp[val]);
        
        // 4. åˆå§‹åŒ– BITï¼Œæ‰€æœ‰å…ƒç´ åˆå§‹çš†å­˜æ´» (å€¼ç‚º 1)
        BIT = vector<int>(n + 1, 0);
        for(int i = 1; i <= n; ++i) {
            BIT[i] += 1;
            int j = i + (i & -i);
            if(j <= n)
                BIT[j] += BIT[i];
        }

        long long rt = 0;
        int pre = -1; // ä¸Šä¸€å€‹åˆªé™¤çš„ç´¢å¼•
        
        // 5. ä¾åºèµ°åˆ°ç›®æ¨™ä¸¦åˆªé™¤
        for(int i = 0; i < n; ++i) {
            int cur = arr[i];
            
            // æƒ…æ³ä¸€ï¼šç›´ç›´å¾€å³èµ°
            if(cur >= pre) {
                rt += getSum(cur) - getSum(pre);
            }
            // æƒ…æ³äºŒï¼šç¹éé™£åˆ—å°¾ç«¯å›åˆ°å‰é¢
            else {
                rt += (getSum(n - 1) - getSum(pre)) + (getSum(cur) - getSum(-1));
            }
            
            // åˆªé™¤è©²å…ƒç´  (å°‡ BIT ä¸­å°æ‡‰ä½ç½®æ¸› 1)
            update(cur, -1);
            pre = cur;
        }

        return rt;
    }
private:
    // å…§éƒ¨è‡ªå‹•è™•ç† 1-indexed è½‰æ›
    long long getSum(int index) {
        ++index;
        long long sum = 0;
        while(index > 0) {
            sum += BIT[index];
            index -= (index & -index);
        }
        return sum;
    }
    
    void update(int index, int val) {
        ++index;
        while(index <= n) {
            BIT[index] += val;
            index += (index & -index);
        }
    }
};
```

<script>
    MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']],
        displayMath: [['$$','$$'], ['\\[', '\\]']],
        processEscapes: true
      },
      options: {
        skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre']
      }
    };
</script>
<script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>